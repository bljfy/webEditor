# 10 修改日志（Change Log）

## 目的
- 记录每次功能改动做了什么、为什么做、带来了什么影响。
- 显式记录当前技术负债，降低后续维护者理解成本。

## 记录规则（强制）
- 每次功能改动提交前，必须更新本文件。
- 每条日志至少包含：`日期`、`提交`、`改动内容`、`影响范围`、`技术负债/后续事项`。
- 纯文案或注释微调可合并记录；涉及行为变化的改动必须单独记录。

---

## 2026-02-18

### 1) 工程初始化与基础质量链路
- 提交：`dd4e241`
- 改动内容：
  - 初始化 `React + TypeScript + Vite`。
  - 接入 `ESLint`、`Vitest`、`Testing Library`、`Prettier`。
  - 建立基础目录与最小可运行页面/测试。
- 影响范围：
  - 工程从静态模板过渡到可持续开发结构。
- 技术负债/后续事项：
  - 仍需补齐 integration/e2e 测试与 CI 发布流程。

### 2) Node 类型配置修复
- 提交：`0bf964f`
- 改动内容：
  - 修复 `tsconfig.node.json`，稳定 `@types/node` 识别。
- 影响范围：
  - 消除 `tsconfig.node.json` 类型报错，保障构建稳定。
- 技术负债/后续事项：
  - 需持续关注 Node/TypeScript 版本升级兼容性。

### 3) Phase 2 基础编辑能力落地
- 提交：`762b79e`
- 改动内容：
  - 新增 `schema/store/panel/preview/renderer` 核心模块。
  - 支持 `meta/theme/nav/hero/sections` 结构化编辑与预览渲染。
- 影响范围：
  - 项目具备“可编辑 + 可预览”的主流程。
- 技术负债/后续事项：
  - 导出链路与预览一致性自动校验尚未实现。

### 4) 零代码产品原则文档化
- 提交：`d5829e5`
- 改动内容：
  - 在 `agent.md` 与关键 `docx` 文档中明确“面向不懂代码用户”。
- 影响范围：
  - 约束后续实现方向，避免技术向交互回潮。
- 技术负债/后续事项：
  - 需持续检查新功能是否违背零代码原则。

### 5) Panel 与页面同滚动（阶段性）
- 提交：`6fecfd2`
- 改动内容：
  - 调整样式，使 Panel 跟随页面滚动。
- 影响范围：
  - 初步改进编辑时的浏览体验。
- 技术负债/后续事项：
  - 后续被“滚动分离”方案替代，相关历史记录保留用于追溯。

### 6) Panel 小白友好重构
- 提交：`f5f0fe5`
- 改动内容：
  - 移除 JSON 编辑入口。
  - 采用全表单化方式编辑各类 section 内容。
  - 文案调整为更直白中文提示。
- 影响范围：
  - 显著降低非技术用户使用门槛。
- 技术负债/后续事项：
  - 表单较长，后续需继续优化分组与交互效率。

### 7) 可折叠表单支持
- 提交：`ca90886`
- 改动内容：
  - 主分组与区块子项支持折叠展开。
- 影响范围：
  - 缓解长表单带来的信息负担。
- 技术负债/后续事项：
  - 可进一步增加“记住展开状态”。

### 8) Panel/Preview 滚动分离与常驻可见
- 提交：`1a859f2`
- 改动内容：
  - 左右面板滚动独立，Panel 常驻可见。
- 影响范围：
  - 用户可边滚动预览边实时编辑。
- 技术负债/后续事项：
  - 需持续验证不同分辨率下滚动行为一致性。

### 9) 草稿-保存式编辑流
- 提交：`9d23c68`
- 改动内容：
  - 取消实时校验与实时更新。
  - 仅在点击“保存更改”时校验并更新预览。
- 影响范围：
  - 解决输入中途被拦截问题，编辑体验更自然。
- 技术负债/后续事项：
  - 可补“离开页面未保存提醒”与“撤销/重做”。

### 10) 中文校验报错与字段定位
- 提交：`c1629eb`
- 改动内容：
  - Zod 错误翻译为中文，附中文路径定位（含数组第 N 项）。
- 影响范围：
  - 用户可快速理解并修复输入错误。
- 技术负债/后续事项：
  - 可继续细化不同错误类型的提示文案。

### 11) 滚动高度计算修复
- 提交：`dfd465d`
- 改动内容：
  - 修复新增卡片后滚动条长度不更新的问题（`min-height: 0` + 明确高度约束）。
- 影响范围：
  - 长内容编辑时滚动行为稳定。
- 技术负债/后续事项：
  - 后续可补充端到端滚动回归测试。

### 12) 场地网格占位配置输入可见性修复
- 提交：`8e102ae`
- 改动内容：
  - 调整 Panel 中 `atlas-row` 布局为纵向堆叠，避免输入项在窄侧栏中被压缩截断。
- 影响范围：
  - 场地网格（含占位开关、图片地址、标题、标签）编辑项可完整显示。
- 技术负债/后续事项：
  - 后续可评估为不同字段设计更紧凑的专用布局，减少纵向空间占用。

### 13) 第三阶段：HTML 导出与一致性校验（进行中）
- 提交：`1401dfe`
- 改动内容：
  - 新增导出模块，支持 `PageConfig -> Renderer -> 单页 HTML` 导出。
  - 在编辑面板加入“导出 HTML”按钮。
  - 新增导出测试，校验文档完整性与渲染结构一致性。
- 影响范围：
  - 用户可直接下载离线 HTML 页面。
  - 预览与导出使用同一渲染源，减少双实现偏差。
- 技术负债/后续事项：
  - 目前为结构一致性验证，后续可补视觉回归校验（截图比对）。

### 14) 第三阶段补充：预览/导出结构一致性集成测试
- 提交：`a3c6c85`
- 改动内容：
  - 新增 `test/integration/preview-export-consistency.test.tsx`。
  - 对关键结构选择器数量进行自动比对，确保预览与导出核心结构一致。
- 影响范围：
  - 提升导出回归检测能力，降低结构漂移风险。
- 技术负债/后续事项：
  - 目前未覆盖像素级视觉回归，后续可接入 Playwright 截图比对。

### 15) 模板动效升级（参考 index_v001）
- 提交：`ef258c3`
- 改动内容：
  - 参考 `assets/templates/legacy/index_v001.legacy.html` 迁移核心视觉与动画风格。
  - 新增预览层氛围噪点、段落入场动画、卡片悬停浮起、横向区块滚动条样式、占位图装饰纹理。
  - 导航胶囊按钮补充 hover 反馈，首屏卡片补充入场和悬停过渡。
- 影响范围：
  - 预览页视觉表现更接近旧版高质感模板，动态反馈更明确。
- 技术负债/后续事项：
  - 当前未迁移“按滚动高亮当前导航”和“点击图片放大”交互，可在后续版本补齐。

### 16) 模板导航与响应式升级（滚动高亮 + 悬浮导航）
- 提交：`14f3786`
- 改动内容：
  - 新增区块可见性观察与当前导航高亮逻辑（IntersectionObserver）。
  - 导航改为悬浮粘性样式，并支持点击平滑滚动到对应区块。
  - section 入场改为滚动触发，补充扫光效果；首屏加入随滚动轻微位移。
- 影响范围：
  - 交互体验更接近参考模板，导航定位更清晰。
- 技术负债/后续事项：
  - 目前仅在预览容器内做滚动监听，后续可增加独立 e2e 用例验证多容器场景。

### 17) 修复导出与预览样式不一致（共享样式源）
- 提交：`44fdce1`
- 改动内容：
  - 新增 `src/renderer/rendererSharedStyles.ts` 作为 Renderer 唯一样式源。
  - `Preview` 与 `Export` 同时引用共享样式，移除页面样式文件中重复的 Renderer 样式块。
  - 文档新增约束：Renderer 视觉改动必须保持预览与导出同源样式。
- 影响范围：
  - 修复“导出文件与预览效果不一致”问题，降低后续回归风险。
- 技术负债/后续事项：
  - 共享样式为字符串形式，后续可考虑提取为可编译的单独样式构建产物。

### 18) 参考模板交互补齐与底部光效修复
- 提交：`9d01be6`
- 改动内容：
  - 补齐图片点击放大弹窗（含遮罩、标题栏、关闭按钮）交互。
  - 修复导航粘性与滚动联动细节，提升“悬浮固定显示”稳定性。
  - 修复下滑到底部时光效丢失问题：放宽区块可见阈值并补充持续氛围光层。
- 影响范围：
  - 预览交互更接近参考模板，滚动到底部时视觉连续性更稳定。
- 技术负债/后续事项：
  - 图片弹窗目前仅支持单张查看，后续可补“左右切换”和键盘导航。

### 19) 响应式卡片布局增强与导航高亮滚动修复
- 提交：`9152837`
- 改动内容：
  - 导航高亮逻辑改为“滚动位置驱动”，修复高亮不随滚动变化的问题。
  - 增强渲染墙、条带画廊、网格区块在多断点下的布局策略（大屏/中屏/小屏）。
  - 优化小屏下卡片尺寸与统计区排版，提升任意尺寸设备的可读性。
- 影响范围：
  - 导航交互稳定性提升，响应式布局覆盖更完整。
- 技术负债/后续事项：
  - 后续可补超宽屏（>= 2K）专用版式和安全边距策略。

### 20) 导出页交互补全（放大与导航高亮）+ 超大屏卡片布局优化
- 提交：`ccd4790`
- 改动内容：
  - 为导出 HTML 注入原生交互脚本，恢复图片点击放大与导航滚动高亮，并支持弹窗上一张/下一张与键盘切换。
  - 增强超大屏（>=1500px）布局：条带区块改为单行多图并排、渲染墙列数提升。
  - 补充叙述区块与瀑布图片区响应式规则，修复不同屏幕下卡片尺寸和图片比例问题。
- 影响范围：
  - 导出文件不再丢失关键交互；大屏展示密度和信息利用率提升。
- 技术负债/后续事项：
  - 导出交互脚本为内联实现，后续可考虑复用同一 TS 源自动生成，减少双端逻辑分叉。

### 21) 渲染墙统一尺寸优化（空间利用增强）
- 提交：`07763bf`
- 改动内容：
  - 将渲染墙从多列瀑布流改为规则网格，并统一图片纵横比（4:5）。
  - 同步优化条带图片区响应式：桌面端改为多列并排，小屏回退横向滑动，提升普通电脑空间利用率。
  - 在中小屏按断点分级降列，保证清晰与可读。
- 影响范围：
  - 瀑布墙与叙述图片区在常见桌面分辨率下可一屏展示更多内容，视觉秩序更稳定。
- 技术负债/后续事项：
  - 若后续需要保留“真实瀑布流”表达，可提供“统一网格/瀑布流”切换配置项。

### 22) Phase 4：CI/CD 与 GitHub Pages 自动发布接入
- 提交：`8d5c928`
- 改动内容：
  - 新增 GitHub Actions `CI` 工作流：在 `main` 分支 push / PR 自动执行 `lint + test + build`。
  - 新增 GitHub Actions `Deploy To GitHub Pages` 工作流：在 `main` push 自动构建并发布 `dist` 到 Pages。
  - Vite 新增 `VITE_BASE_PATH` 支持，并在部署工作流按仓库名自动计算 Pages `base` 路径（`/` 或 `/<repo>/`）。
  - README 与 agent 维护规则同步更新，明确部署步骤与变更约束。
- 影响范围：
  - 代码质量门禁与静态发布流程自动化，减少手工发布与路径配置错误。
- 技术负债/后续事项：
  - 目前仅接入 unit/integration 级测试；后续可补充 Playwright e2e 与视觉回归后再纳入发布门禁。

### 23) 修复导出单页缺失滚动入场动画（与预览行为对齐）
- 提交：`f67aab2`
- 改动内容：
  - 移除导出渲染时对 `section-anim` 的强制 `visible` 注入，恢复“初始隐藏、滚动触发显现”机制。
  - 在导出脚本中新增 `IntersectionObserver` 区块入场逻辑；不支持观察器时降级为直接显示。
  - 修正 Renderer 在无 `IntersectionObserver` 环境下的预览降级逻辑，避免区块长期不可见。
  - 新增单测覆盖“导出初始 markup 不应强制 visible”。
- 影响范围：
  - 预览与导出单页的区块入场动画行为一致，减少体验差异与回归风险。
- 技术负债/后续事项：
  - 当前一致性校验仍偏结构层，后续可补充动画触发时序的 e2e 断言。

### 24) 模板新增视觉化页脚（预览/导出一致）
- 提交：`8869a69`
- 改动内容：
  - 扩展 `PageConfig.footer` 结构，新增页脚标语、页脚链接、版权文案配置字段。
  - 为模板新增统一页脚模块（标题、标语、页脚链接、版权信息）。
  - 页脚样式采用渐变背景与胶囊链接风格，提升页面收尾质感。
  - Panel 新增“页脚设置”分组，支持零代码编辑页脚文案与链接。
  - 新增响应式规则，保证中小屏下页脚内容可读与可点击。
- 影响范围：
  - 预览与导出单页都获得一致的页脚展示，并可在编辑面板直接自定义。
- 技术负债/后续事项：
  - 页脚链接当前仅支持基础文本与地址，后续可扩展图标、打开方式（新窗口）与链接分组。

### 25) 编辑体验增强：未保存提醒 + 撤销重做 + 区块拖拽排序
- 提交：`bbed867`
- 改动内容：
  - 新增未保存离开提醒：存在草稿变更时关闭/刷新页面会触发浏览器确认提示。
  - 新增撤销/重做能力：支持按钮操作与快捷键（Ctrl/Cmd + Z、Ctrl/Cmd + Y）。
  - 新增区块拖拽排序：在“内容区块”中可拖拽调整区块顺序。
  - 补充编辑交互提示文案与样式反馈，降低非技术用户的学习成本。
- 影响范围：
  - 编辑稳定性与容错能力提升，减少误操作导致的数据丢失。
- 技术负债/后续事项：
  - 目前历史栈为会话内内存实现，刷新后不会保留；后续可考虑本地持久化。
